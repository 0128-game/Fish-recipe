<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>レシピ一覧</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }
    th {
      background: #eee;
    }
    img.thumb {
      max-width: 80px;
      max-height: 80px;
      object-fit: cover;
      display: block;
    }
    .no-img {
      color: #888;
      font-size: 0.9em;
    }
    @media (max-width: 768px) {
      table {
        font-size: 12px;
      }
      img.thumb {
        max-width: 50px;
        max-height: 50px;
      }
    }
  </style>
</head>
<body>
  <h1>レシピ一覧</h1>
  <table id="recipe-table">
    <thead>
      <tr>
        <th>No</th>
        <th>type</th>
        <th>pictures</th>
        <th>flavortxt</th>
        <th>title</th>
        <th>fish-name</th>
        <th>feature</th>
        <th>season</th>
        <th>difficulty</th>
        <th>cost</th>
        <th>timing</th>
        <th>time</th>
        <th>pre-recipe</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script>
    async function loadRecipes() {
      try {
        const response = await fetch('./docs/recipes.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('JSONの読み込みに失敗しました');
        const data = await response.json();

        const tableBody = document.querySelector('#recipe-table tbody');

        const allItems = [...(data.recipes || []), ...(data.preparations || [])];

        allItems.forEach(item => {
          const tr = document.createElement('tr');

          // No
          tr.appendChild(createCell(item.No));

          // type
          tr.appendChild(createCell(item.type));

          // pictures
          const picCell = document.createElement('td');
          if (Array.isArray(item.pictures) && item.pictures.length > 0) {
            const firstPic = item.pictures.find(p => p !== null);
            if (firstPic) {
              const img = document.createElement('img');
              img.src = firstPic;
              img.alt = 'サムネイル';
              img.className = 'thumb';
              picCell.appendChild(img);
            } else {
              picCell.textContent = 'なし';
              picCell.className = 'no-img';
            }
          } else {
            picCell.textContent = 'なし';
            picCell.className = 'no-img';
          }
          tr.appendChild(picCell);

          // flavortxt
          tr.appendChild(createCell(item.flavortxt || ''));

          // title
          tr.appendChild(createCell(item.title || ''));

          // fish-name
          tr.appendChild(createCell(Array.isArray(item['fish-name']) ? item['fish-name'].join(', ') : ''));

          // feature
          tr.appendChild(createCell(Array.isArray(item.feature) ? item.feature.join(', ') : ''));

          // season
          tr.appendChild(createCell(Array.isArray(item.season) ? item.season.join(', ') : ''));

          // difficulty
          tr.appendChild(createCell(item.difficulty));

          // cost
          tr.appendChild(createCell(item.cost));

          // timing（料理のみ）
          tr.appendChild(createCell(item.timing || ''));

          // time
          tr.appendChild(createCell(item.time));

          // pre-recipe
          tr.appendChild(createCell(item['pre-recipe'] || ''));

          tableBody.appendChild(tr);
        });
      } catch (err) {
        console.error(err);
        alert('レシピの読み込みでエラーが発生しました');
      }
    }

    function createCell(text) {
      const td = document.createElement('td');
      td.textContent = text ?? '';
      return td;
    }

    loadRecipes();
  </script>
</body>
</html>
