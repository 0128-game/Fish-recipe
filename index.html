<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>魚料理レシピ一覧</title>
<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --accent:#2b6cb0;
    --muted:#666;
    --success:#2f855a;
    --danger:#c53030;
    --max-width:1200px;
  }
  *{box-sizing:border-box}
  body{
    font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo",sans-serif;
    margin:0;
    background:var(--bg);
    color:#222;
    padding:20px;
    display:flex;
    justify-content:center;
  }
  .wrap{
    width:100%;
    max-width:var(--max-width);
  }
  header{
    display:flex;
    gap:12px;
    align-items:flex-start;
    margin-bottom:18px;
  }
  header h1{margin:0;font-size:1.3rem}
  .controls{
    margin-left:auto;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }
  input[type="search"], select{
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #d6d8df;
    background:white;
  }
  button{
    padding:8px 12px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:white;
    cursor:pointer;
  }
  button:disabled{opacity:.6;cursor:not-allowed}
  main{
    background:transparent;
  }
  table{
    width:100%;
    border-collapse:collapse;
    background:var(--card);
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 6px 18px rgba(20,20,40,0.06);
  }
  thead th{
    text-align:left;
    padding:10px 12px;
    font-size:0.85rem;
    background:#f1f5f9;
    border-bottom:1px solid #eee;
    position:sticky;
    top:0;
    z-index:1;
  }
  tbody td{
    padding:10px 12px;
    border-bottom:1px dashed #eee;
    vertical-align:top;
    font-size:0.95rem;
  }
  tbody tr:hover{background:rgba(43,108,176,0.03)}
  .muted{color:var(--muted);font-size:0.85rem}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef5ff;color:var(--accent);font-size:0.8rem}
  .actions button{margin-right:6px}
  .tag-type{padding:4px 8px;border-radius:6px;font-size:0.8rem}
  .type-recipe{background:#fff7ed;color:#b45309;border:1px solid #f6e7d0}
  .type-pre{background:#f0fff4;color:#2f855a;border:1px solid #d6f7df}

  /* ★ Picture列用スタイル追加 */
  table th:nth-child(3),
  table td:nth-child(3) {
    width:70px; 
    text-align:center;
  }

  /* modal */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(12,18,30,0.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000;
  }
  .modal{
    width:100%;max-width:760px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(10,20,40,0.25);
    max-height:90vh;overflow:auto;
  }
  .modal h2{margin:0 0 8px 0}
  .modal .meta{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px}
  .grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
  }
  .section-title{font-weight:700;margin:10px 0 6px 0}
  ul{margin:6px 0 12px 20px}
  pre{white-space:pre-wrap;background:#f8fafc;padding:10px;border-radius:8px;border:1px solid #eef2f7}
  .small{font-size:0.85rem;color:var(--muted)}
  footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;gap:10px}
  @media (max-width:700px){
    .grid{grid-template-columns:1fr}
    header{align-items:center}
  }
  .notice{padding:12px;border-radius:8px;background:#fff3f3;color:#c53030;border:1px solid rgba(197,48,48,0.12);margin-bottom:12px}
</style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>魚料理レシピ一覧</h1>
      <div class="controls" aria-hidden="false">
        <label class="small" for="q">検索:</label>
        <input id="q" type="search" placeholder="タイトル・魚名・特徴などを検索">
        <label class="small" for="filterType">タイプ:</label>
        <select id="filterType">
          <option value="all">すべて</option>
          <option value="recipe">料理 (recipe)</option>
          <option value="pre">下処理 (pre)</option>
        </select>
        <label class="small" for="sortBy">並び替え:</label>
        <select id="sortBy">
          <option value="No">No（昇順）</option>
          <option value="-No">No（降順）</option>
          <option value="cost">費用（昇順）</option>
          <option value="-cost">費用（降順）</option>
          <option value="time">所要時間（昇順）</option>
          <option value="-time">所要時間（降順）</option>
        </select>
        <button id="reloadBtn" title="再読み込み">再読み込み</button>
      </div>
    </header>

    <main>
      <div id="message" role="status" aria-live="polite" style="margin-bottom:10px"></div>

      <div style="overflow:auto;border-radius:10px">
        <table id="recipeTable" aria-describedby="message">
          <thead>
            <tr>
              <th style="width:70px">No</th>
              <th style="width:80px">Type</th>
              <th style="width:70px">Picture</th>
              <th>Title / flavortxt</th>
              <th style="width:160px">魚 / 旬</th>
              <th style="width:120px">難易度 / 時間</th>
              <th style="width:120px">費用 / 下処理参照</th>
              <th style="width:110px">操作</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </main>

      <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal" role="document" aria-labelledby="modalTitle">
        <button id="closeModal" style="float:right;border:none;background:transparent;font-size:1.1rem;cursor:pointer">✕</button>
        <h2 id="modalTitle"></h2>
        <div id="modalSubtitle" class="small"></div>

        <div class="meta" id="metaInfo"></div>

        <div class="grid">
          <div>
            <div class="section-title">材料</div>
            <div id="modalIngredients"></div>
            <div class="section-title">手順</div>
            <div id="modalRecipe"></div>
          </div>
          <div>
            <div class="section-title">メモ / 追加情報</div>
            <div id="modalMemo"></div>

            <div class="section-title">その他 (props)</div>
            <div id="modalProps" class="small"></div>

            <div class="section-title">pictures</div>
            <div id="modalPictures" class="small"></div>
          </div>
        </div>

        <footer>
          <div class="small">データソース: <code>docs/recipes.json</code></div>
          <div>
            <button id="openRaw">Raw 表示</button>
            <button id="closeFooter">閉じる</button>
          </div>
        </footer>
      </div>
    </div>

  </div>

<script>
const tbody = document.getElementById("tbody");
const q = document.getElementById("q");
const filterType = document.getElementById("filterType");
const sortBy = document.getElementById("sortBy");
const reloadBtn = document.getElementById("reloadBtn");

let recipes = [];

async function loadData(){
  const res = await fetch("docs/recipes.json");
  recipes = await res.json();
  renderTable();
}

function renderTable(){
  const term = q.value.toLowerCase();
  const type = filterType.value;
  const sort = sortBy.value;
  let filtered = recipes.filter(r=>{
    const matchTerm = r.title.toLowerCase().includes(term) || (r.flavortxt && r.flavortxt.toLowerCase().includes(term));
    const matchType = type==="all" ? true : r.type===type;
    return matchTerm && matchType;
  });
  if(sort){
    const desc = sort.startsWith("-");
    const key = desc ? sort.slice(1) : sort;
    filtered.sort((a,b)=>{
      let va=a[key], vb=b[key];
      if(typeof va==="string") va=va.toLowerCase();
      if(typeof vb==="string") vb=vb.toLowerCase();
      if(va>vb) return desc?-1:1;
      if(va<vb) return desc?1:-1;
      return 0;
    });
  }
  tbody.innerHTML="";
  filtered.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.No}</td>
      <td><span class="tag-type type-${r.type}">${r.type}</span></td>
      <td>${r.pictures && r.pictures[0] ? `<img src="${r.pictures[0]}" alt="picture" style="width:50px;height:auto;border-radius:4px">` : "—"}</td>
      <td><strong>${r.title}</strong><br><span class="muted">${r.flavortxt||""}</span></td>
      <td>${r.fish || ""} ${r.season||""}</td>
      <td>${r.level||""} / ${r.time||""}</td>
      <td>${r.cost||""} / ${r.preRef||""}</td>
      <td class="actions">
        <button onclick="openModal('${r.No}')">表示</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

const modalBackdrop = document.getElementById("modalBackdrop");
const closeModalBtn = document.getElementById("closeModal");
function openModal(no){
  const r = recipes.find(x=>x.No===no);
  if(!r) return;
  document.getElementById("modalTitle").textContent = r.title;
  document.getElementById("modalSubtitle").textContent = r.flavortxt||"";
  document.getElementById("modalIngredients").innerHTML = r.ingredients ? `<ul>${r.ingredients.map(i=>`<li>${i}</li>`).join("")}</ul>` : "";
  document.getElementById("modalRecipe").innerHTML = r.recipe ? `<ol>${r.recipe.map(s=>`<li>${s}</li>`).join("")}</ol>` : "";
  document.getElementById("modalMemo").innerHTML = r.memo || "";
  document.getElementById("modalProps").textContent = JSON.stringify(r.props||{},null,2);
  document.getElementById("modalPictures").innerHTML = r.pictures ? r.pictures.map(p=>p?`<img src="${p}" style="width:60px;margin:2px;border-radius:4px">`:"—").join("") : "—";
  modalBackdrop.style.display="flex";
  modalBackdrop.setAttribute("aria-hidden","false");
}
closeModalBtn.addEventListener("click",()=>{modalBackdrop.style.display="none";modalBackdrop.setAttribute("aria-hidden","true")});
document.getElementById("closeFooter").addEventListener("click",()=>{modalBackdrop.style.display="none";modalBackdrop.setAttribute("aria-hidden","true")});
reloadBtn.addEventListener("click",loadData);
q.addEventListener("input",renderTable);
filterType.addEventListener("change",renderTable);
sortBy.addEventListener("change",renderTable);

loadData();
</script>
</body>
</html>
