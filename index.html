<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>é­šæ–™ç†ãƒ¬ã‚·ãƒ”ä¸€è¦§</title>
<!-- ğŸ‘‡ CSSã¯å…ƒã®ã¾ã¾ï¼ˆçœç•¥ãªã—ï¼‰ -->
<style>
:root{
  --bg:#f6f7fb; /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
  --card:#ffffff; /* ç™½ */
  --accent:#2b6cb0; /* æ¿ƒã„é’ */
  --muted:#666;
  --success:#2f855a;
  --danger:#c53030;
  --max-width:1200px;
  /* è¦–èªæ€§å‘ä¸Šã®ãŸã‚ã€ãƒ˜ãƒƒãƒ€ãƒ¼èƒŒæ™¯è‰²ã‚’ã‚ãšã‹ã«æ¿ƒã */
  --header-bg:#e2e8f0;
}
*{box-sizing:border-box}
body{
  font-family:"Hiragino Kaku Gothic ProN","Yu Gothic","Meiryo",sans-serif;
  margin:0;
  background:var(--bg);
  color:#222;
  padding:20px;
  display:flex;
  justify-content:center;
}
.wrap{
  width:100%;
  max-width:var(--max-width);
}
header{
  display:flex;
  flex-direction:row;
  gap:12px;
  align-items:flex-start;
  margin-bottom:18px;
}
header h1{margin:0;font-size:1.3rem}
.controls{
  margin-left:auto;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
input[type="search"], select{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #d6d8df;
  background:white;
}
button{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  background:var(--accent);
  color:white;
  cursor:pointer;
}
button:disabled{opacity:.6;cursor:not-allowed}
main{
  background:transparent;
}
table{
  width:100%;
  border-collapse:collapse;
  background:var(--card);
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 6px 18px rgba(20,20,40,0.06);
}
thead th{
  text-align:left;
  padding:10px 12px;
  font-size:0.85rem;
  background:var(--header-bg);
  border-bottom:1px solid #eee;
  position:sticky;
  top:0;
  z-index:1;
  white-space:nowrap;
}
tbody td{
  padding:10px 12px;
  border-bottom:1px dashed #eee;
  vertical-align:top;
  font-size:0.95rem;
}
tbody tr:hover{background:rgba(43,108,176,0.03)}
.muted{color:var(--muted);font-size:0.85rem}
.pill{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  background:#eef5ff;
  color:var(--accent);
  font-size:0.8rem;
}
.actions button{margin-right:6px}
.tag-type{padding:4px 8px;border-radius:6px;font-size:0.8rem}
.type-recipe{background:#fff7ed;color:#b45309;border:1px solid #f6e7d0}
.type-pre{background:#f0fff4;color:#2f855a;border:1px solid #d6f7df}
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(12,18,30,0.45);
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index:1000;
}
.modal{
  width:100%;
  max-width:760px;
  background:var(--card);
  border-radius:12px;
  padding:18px;
  box-shadow:0 10px 30px rgba(10,20,40,0.25);
  max-height:90vh;
  overflow:auto;
}
.modal h2{margin:0 0 8px 0}
.modal .meta{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:8px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.section-title{
  font-weight:700;
  margin:10px 0 6px 0;
}
ul{margin:6px 0 12px 20px}
pre{
  white-space:pre-wrap;
  background:#f8fafc;
  padding:10px;
  border-radius:8px;
  border:1px solid #eef2f7;
}
.small{font-size:0.85rem;color:var(--muted)}
footer{
  margin-top:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
@media (max-width:700px){
  header{
    flex-direction:column;
    align-items:stretch;
  }
  header h1{margin-bottom:8px;}
  .controls{
    margin-left:0;
    justify-content:flex-start;
    gap:10px;
  }
  .grid{grid-template-columns:1fr}
}
.notice{
  padding:12px;
  border-radius:8px;
  background:#fff3f3;
  color:var(--danger);
  border:1px solid rgba(197,48,48,0.12);
  margin-bottom:12px;
}

</style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>é­šæ–™ç†ãƒ¬ã‚·ãƒ”ä¸€è¦§</h1>
      <div class="controls" aria-hidden="false">
        <label class="small" for="q">æ¤œç´¢:</label>
        <input id="q" type="search" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ãƒ»é­šåãƒ»ç‰¹å¾´ãªã©ã‚’æ¤œç´¢">
        <label class="small" for="filterType">ã‚¿ã‚¤ãƒ—:</label>
        <select id="filterType">
          <option value="all">ã™ã¹ã¦</option>
          <option value="recipe">æ–™ç† (recipe)</option>
          <option value="pre">ä¸‹å‡¦ç† (pre)</option>
        </select>
        <label class="small" for="sortBy">ä¸¦ã³æ›¿ãˆ:</label>
        <select id="sortBy">
          <option value="No">Noï¼ˆæ˜‡é †ï¼‰</option>
          <option value="-No">Noï¼ˆé™é †ï¼‰</option>
          <option value="cost">è²»ç”¨ï¼ˆæ˜‡é †ï¼‰</option>
          <option value="-cost">è²»ç”¨ï¼ˆé™é †ï¼‰</option>
          <option value="time">æ‰€è¦æ™‚é–“ï¼ˆæ˜‡é †ï¼‰</option>
          <option value="-time">æ‰€è¦æ™‚é–“ï¼ˆé™é †ï¼‰</option>
        </select>
        <button id="reloadBtn" title="å†èª­ã¿è¾¼ã¿">å†èª­ã¿è¾¼ã¿</button>
      </div>
    </header>

    <main>
      <div id="message" role="status" aria-live="polite" style="margin-bottom:10px"></div>
      <div style="overflow:auto;border-radius:10px">
        <table id="recipeTable" aria-describedby="message">
          <thead>
            <tr>
              <th style="width:70px">No</th>
              <th style="width:80px">Type</th>
              <th style="width:70px">Picture</th>
              <th>Title / flavortxt</th>
              <th style="width:160px">é­š / æ—¬</th>
              <th style="width:120px">é›£æ˜“åº¦ / æ™‚é–“</th>
              <th style="width:120px">è²»ç”¨ / ä¸‹å‡¦ç†å‚ç…§</th>
              <th style="width:110px">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </main>

<script>
(function(){
Â  const tryPaths = [
Â  Â  'docs/recipes.json',
Â  Â  './docs/recipes.json',
Â  Â  '/recipes.json',
Â  Â  './recipes.json'
Â  ];

Â  const tbody = document.getElementById('tbody');
Â  const qInput = document.getElementById('q');
Â  const filterType = document.getElementById('filterType');
Â  const sortBy = document.getElementById('sortBy');
Â  const reloadBtn = document.getElementById('reloadBtn');
Â  const message = document.getElementById('message');

Â  let recipes = [];

Â  // JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…åˆ—ã«å¤‰æ›ã—ã€ã‚­ãƒ¼åã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ç”¨ã«æ•´å½¢ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
Â  function normalizeData(dataObject) {
Â  Â  return Object.keys(dataObject).map(key => {
Â  Â  Â  const item = dataObject[key];
Â  Â  Â  
Â  Â  Â  // 1. ã‚­ãƒ¼åã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã®æç”»ã«åˆã‚ã›ã¦ä¿®æ­£
Â  Â  Â  return {
Â  Â  Â  Â  No: item.No ?? '',
Â  Â  Â  Â  type: item.type ?? '',
Â  Â  Â  Â  title: item.title ?? '',
Â  Â  Â  Â  flavortxt: item.flavortxt ?? '',
Â  Â  Â  Â  
Â  Â  Â  Â  // 'fish-name' (é…åˆ—) ã‚’ 'fish' (æ–‡å­—åˆ—) ã«å¤‰æ›
Â  Â  Â  Â  fish: Array.isArray(item['fish-name']) ? item['fish-name'].join('ã€') : (item['fish-name'] ?? ''),
Â  Â  Â  Â  
Â  Â  Â  Â  season: Array.isArray(item.season) ? item.season.join('ã€') : (item.season ?? ''),
Â  Â  Â  Â  
Â  Â  Â  Â  // 'difficulty' ã‚’ 'level' ã«å¤‰æ›´
Â  Â  Â  Â  level: item.difficulty ?? '',
Â  Â  Â  Â  
Â  Â  Â  Â  cost: item.cost ?? 0,
Â  Â  Â  Â  time: item.time ?? 0,
Â  Â  Â  Â  
Â  Â  Â  Â  // 'pre-recipe' ã‚’ 'pre-ref' ã«å¤‰æ›´
Â  Â  Â  Â  'pre-ref': item['pre-recipe'] ?? '',
Â  Â  Â  Â  
Â  Â  Â  Â  // ãã®ä»–ã€æ¤œç´¢ã§åˆ©ç”¨ã™ã‚‹ã‚­ãƒ¼ã‚‚è¿½åŠ 
Â  Â  Â  Â  'feature': Array.isArray(item.feature) ? item.feature.join('ã€') : (item.feature ?? ''),

Â  Â  Â  Â  // è©³ç´°è¡¨ç¤ºç”¨ã«å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’æ®‹ã™ï¼ˆã“ã“ã§ã¯æœªä½¿ç”¨ã ãŒæ±ç”¨æ€§ã®ãŸã‚ï¼‰
Â  Â  Â  Â  original: item
Â  Â  Â  };
Â  Â  });
Â  }


Â  async function loadData(){
Â  Â  for (const path of tryPaths){
Â  Â  Â  try{
Â  Â  Â  Â  const res = await fetch(path);
Â  Â  Â  Â  if(!res.ok) continue;
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  
Â  Â  Â  Â  // 2. JSONã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’é…åˆ—ã«å¤‰æ›ã—ã€ã‚­ãƒ¼åã‚’ä¿®æ­£
Â  Â  Â  Â  // recipesã¨preparationsã®ä¸¡æ–¹ã‚’é…åˆ—ã¨ã—ã¦çµåˆ
Â  Â  Â  Â  const normalizedRecipes = data.recipes ? normalizeData(data.recipes) : [];
Â  Â  Â  Â  const normalizedPreparations = data.preparations ? normalizeData(data.preparations) : [];
Â  Â  Â  Â  
Â  Â  Â  Â  recipes = [...normalizedRecipes, ...normalizedPreparations];
Â  Â  Â  Â  
Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  return;
Â  Â  Â  }catch(e){
Â  Â  Â  Â  console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¾ãŸã¯è§£æã‚¨ãƒ©ãƒ¼:", e);
Â  Â  Â  }
Â  Â  }
Â  Â  message.textContent = 'JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
Â  }

Â  function renderTable(){
Â  Â  const q = qInput.value.trim().toLowerCase();
Â  Â  const typeFilter = filterType.value;

Â  Â  let list = recipes.filter(item=>{
Â  Â  Â  if(typeFilter!=='all' && item.type!==typeFilter) return false;
Â  Â  Â  
Â  Â  Â  // æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ (ã‚¿ã‚¤ãƒˆãƒ«, ç‰¹å¾´æ–‡, é­šå, æ—¬, ç‰¹å¾´ã§æ¤œç´¢)
Â  Â  Â  if(q){
Â  Â  Â  Â  const searchableFields = [item.title, item.flavortxt, item.fish, item.season, item.feature];
Â  Â  Â  Â  const isMatch = searchableFields.some(field => field && String(field).toLowerCase().includes(q));
Â  Â  Â  Â  if (!isMatch) {
Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  return true;
Â  Â  });

Â  Â  const sortVal = sortBy.value;
Â  Â  const desc = sortVal.startsWith('-');
Â  Â  const key = desc ? sortVal.slice(1) : sortVal;
Â  Â  list.sort((a,b)=>{
Â  Â  Â  let av = a[key] ?? '';
Â  Â  Â  let bv = b[key] ?? '';
Â  Â  Â  if(!isNaN(av) && !isNaN(bv)){ av = Number(av); bv = Number(bv); }
Â  Â  Â  if(av<bv) return desc?1:-1;
Â  Â  Â  if(av>bv) return desc?-1:1;
Â  Â  Â  return 0;
Â  Â  });

Â  Â  tbody.innerHTML='';
Â  Â  // çµæœä»¶æ•°ã‚’è¡¨ç¤ºã«è¿½åŠ 
Â  Â  message.textContent = `å…¨ ${recipes.length} ä»¶ä¸­ã€${list.length} ä»¶ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚`;
Â  Â  
Â  Â  for(const item of list){
Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  <td>${item.No??''}</td>
Â  Â  Â  Â  <td><span class="tag-type ${item.type==='recipe'?'type-recipe':'type-pre'}">${item.type}</span></td>
Â  Â  Â  Â  <td>&nbsp;</td>Â  Â  Â  Â  Â  <td><div><strong>${item.title??''}</strong></div><div class="muted">${item.flavortxt??''}</div></td>
Â  Â  Â  Â  <td>${item.fish??''}<div class="muted">${item.season??''}</div></td>
Â  Â  Â  Â  <td>${item.level??''}<div class="muted">${item.time??''}åˆ†</div></td>
Â  Â  Â  Â  <td>${item.cost??''}å††<div class="muted">${item['pre-ref']??''}</div></td>
Â  Â  Â  Â  <td class="actions">
Â  Â  Â  Â  Â  <button>è©³ç´°</button>
Â  Â  Â  Â  </td>
Â  Â  Â  `;
Â  Â  Â  tbody.appendChild(tr);
Â  Â  }
Â  }

Â  qInput.addEventListener('input',renderTable);
Â  filterType.addEventListener('change',renderTable);
Â  sortBy.addEventListener('change',renderTable);
Â  reloadBtn.addEventListener('click',loadData);

Â  loadData();
})();
</script>
</body>
</html>
